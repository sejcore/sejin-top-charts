<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>Sejin's Top Charts ‚Äî KR Drama</title>
    <!-- Tailwind Play CDN (no build needed) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      :root { color-scheme: dark; }
      body { background:#000; }
      /* Star rating: gray background stars + clipped gold overlay */
      .stars {
        position: relative; display: inline-block; line-height: 1;
        font-size: 18px; letter-spacing: 2px;
      }
      .stars .bg { color: #3f3f46; }      /* gray */
      .stars .fg {
        color: #FFD54A;                    /* gold */
        position: absolute; left: 0; top: 0; overflow: hidden; white-space: nowrap;
      }
      /* Poster aspect & polish */
      .poster {
        width: 100%; aspect-ratio: 2/3; object-fit: cover;
        border-radius: 0.75rem; border:1px solid #262626;
      }
      .card {
        background: rgba(23,23,23,.6);
        backdrop-filter: blur(6px);
        border: 1px solid #262626;
        border-radius: 1rem;
      }
    </style>
  </head>
  <body class="min-h-screen text-white">
    <header class="max-w-6xl mx-auto px-4 py-8">
      <h1 class="text-3xl md:text-4xl font-bold tracking-wide text-center">Sejin's Top Charts</h1>
      <p class="text-center text-neutral-400 mt-2">üá∞üá∑ KR Drama ‚Äî live from Google Sheets</p>
    </header>

    <main class="max-w-6xl mx-auto px-4 pb-16">
      <!-- Grid -->
      <div id="grid" class="grid gap-6 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4"></div>

      <!-- Status -->
      <div id="status" class="text-center text-neutral-400 mt-10"></div>
    </main>

    <footer class="text-center text-xs text-neutral-500 pb-10">
      Images are read from <code>/images/</code>. Filenames come from Column F (KR Drama tab).
    </footer>

    <script>
      // ‚úÖ Config
      const SHEET_ID = '1bUhsAN58vjTtDpRmbciDszWbgANzjuFDOyO48hH-Jwg';
      const API_KEY  = 'AIzaSyAnYfAfgCELD3iP9NCJMbCoJOCAbEyeUz0';
      const TAB_NAME = 'KR Drama';        // for now, just this tab
      const IMG_DIR  = 'images/';         // upload your posters here
      const PLACEHOLDER = IMG_DIR + 'placeholder.png';

      const statusEl = document.getElementById('status');
      const gridEl = document.getElementById('grid');

      function starHTML(value) {
        const clamped = Math.max(0, Math.min(5, Number(value) || 0));
        const pct = (clamped / 5) * 100;
        const stars = '‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ'; // 5 stars
        return `
          <span class="stars" aria-label="Rating ${clamped} of 5">
            <span class="bg">${stars}</span>
            <span class="fg" style="width:${pct}%">${stars}</span>
          </span>
          <span class="text-neutral-400 text-xs ml-2">${clamped.toFixed(1)}</span>
        `;
      }

      function cardHTML(item) {
        const img = item.image ? (IMG_DIR + item.image) : PLACEHOLDER;
        const title = item.title || 'Untitled';
        const release = item.release || '';
        const producer = item.producer || '';
        return `
          <article class="card p-3">
            <img class="poster mb-3" src="${img}" alt="${title}" onerror="this.src='${PLACEHOLDER}'"/>
            <div class="flex items-start justify-between">
              <h3 class="text-base font-semibold leading-tight">${title}</h3>
              <span class="ml-2 text-xs text-neutral-400">#${item.rank || ''}</span>
            </div>
            ${release ? `<div class="text-xs font-semibold text-neutral-300 mt-1">${release}</div>` : ''}
            ${producer ? `<div class="text-xs font-semibold text-neutral-400">${producer}</div>` : ''}
            <div class="mt-2">${starHTML(item.rating)}</div>
          </article>
        `;
      }

      async function loadKRDrama() {
        statusEl.textContent = 'Loading‚Ä¶';
        try {
          const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/'${encodeURIComponent(TAB_NAME)}'?key=${API_KEY}`;
          const res = await fetch(url);
          if (!res.ok) throw new Error('Sheets API ' + res.status);
          const json = await res.json();
          const rows = json.values || [];
          if (rows.length < 2) { statusEl.textContent = 'No data found.'; return; }

          // Skip header row
          const [, ...data] = rows;
          // Columns: A Rank, B Title, C Release, D Producer, E Rating, F Image
          const items = data.map((r, i) => ({
            rank: r[0] ?? String(i+1),
            title: r[1] ?? '',
            release: r[2] ?? '',
            producer: r[3] ?? '',
            rating: parseFloat(r[4] ?? '0') || 0,
            image: (r[5] || '').trim()
          }));

          // Render
          gridEl.innerHTML = items.map(cardHTML).join('');
          statusEl.textContent = '';
        } catch (err) {
          console.error(err);
          statusEl.innerHTML = `<span class="text-red-400">Failed to load. Check Sheet sharing (Anyone with link ‚Üí Viewer), API key, and tab name ‚Äú${TAB_NAME}‚Äù.</span>`;
        }
      }

      loadKRDrama();
    </script>
  </body>
</html>
