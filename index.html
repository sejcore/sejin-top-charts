<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>Sejin's Top Charts</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      :root { color-scheme: dark; }
      body { background:#000; }

      /* ========== Shared UI ========== */
      .stars { position: relative; display: inline-block; font-size: 18px; letter-spacing: 2px; }
      .stars .bg { color: #3f3f46; }
      .stars .fg { color: #FFD54A; position: absolute; left: 0; top: 0; overflow: hidden; white-space: nowrap; }
      .poster { width: 100%; aspect-ratio: 2/3; object-fit: cover; border-radius: 0.75rem; border:1px solid #262626; }
      .card { background: rgba(23,23,23,.6); backdrop-filter: blur(6px); border: 1px solid #262626; border-radius: 1rem; }
      .rank { font-size: 1.7rem; font-weight: 900; color: #FFD54A; }
      .flag-icon { width: 16px; height: 12px; object-fit: cover; display: inline-block; vertical-align: middle; }

      /* ========== Splash ========== */
      #splash {
        --bg:url('images/splash-hacker.jpg');
        position: fixed; inset: 0; width: 100%; height: 100%;
        background: #000 var(--bg) center/cover no-repeat;
        z-index: 50; display: flex; flex-direction: column;
        justify-content: center; align-items: center;
        text-align: center; padding: 2rem;
        font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue",
                     Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji", sans-serif;
      }

      /* Disclaimer box */
      #splash .disclaimer {
        max-width: 48rem; /* 768px */
        margin-top: 1.25rem;
        line-height: 1.6;
        color: rgba(243, 244, 246, .92);
        background: rgba(0,0,0,.45);
        border: 1px solid #262626;
        border-radius: 1rem;
        padding: 1.15rem 1.1rem;
        backdrop-filter: blur(6px);
        text-shadow: 0 0 10px rgba(0,0,0,.55);
        font-size: 1rem;
      }

      /* Mobile: smaller splash text & button */
      @media (max-width: 480px) {
        #splash .disclaimer { font-size: .9rem; }
        #enterBtn { font-size: 1.05rem; padding: .8rem 1.3rem; }
      }

      /* Enter button — neon blue glow */
      #enterBtn {
        background-color: #60a5fa; /* blue-400 */
        color: #020617;
        font-size: 1.35rem;
        font-weight: 800;
        padding: .95rem 1.4rem;
        border-radius: 9999px;
        text-transform: uppercase;
        box-shadow: 0 0 22px rgba(96,165,250,.55),
                    0 0 56px rgba(96,165,250,.35),
                    inset 0 0 6px rgba(255,255,255,.25);
        transition: transform .12s ease, box-shadow .2s ease;
      }
      #enterBtn:hover { transform: translateY(-1px) scale(1.01);
        box-shadow: 0 0 30px rgba(96,165,250,.72), 0 0 80px rgba(96,165,250,.45), inset 0 0 10px rgba(255,255,255,.28); }
      #enterBtn:active { transform: translateY(0) scale(.99); }

      /* Glitch layers (use same background via CSS var) */
      #splash .glitch-layer,
      #splash .glitch-scan {
        position: absolute; inset: 0; pointer-events: none;
      }
      #splash .glitch-layer {
        background: var(--bg) center/cover no-repeat;
        mix-blend-mode: screen;
        opacity: 0;
      }
      #splash.glitching .glitch-layer {
        animation: glitchShift 120ms steps(2) 0s 6 alternate,
                   flicker 380ms linear 1;
        opacity: .35;
      }
      /* Scanline sweep */
      #splash .glitch-scan {
        background: linear-gradient(to bottom, rgba(255,255,255,0) 0%,
                                    rgba(255,255,255,0.05) 50%,
                                    rgba(255,255,255,0) 100%);
        transform: translateY(-100%);
        opacity: 0;
      }
      #splash.glitching .glitch-scan {
        animation: scan 420ms linear 1;
        opacity: .25;
      }

      @keyframes glitchShift {
        0%   { transform: translate(0,0) skewX(0deg); filter: hue-rotate(0deg) contrast(110%); }
        25%  { transform: translate(-6px,1px) skewX(-2deg); }
        50%  { transform: translate(6px,-1px) skewX(2deg); }
        75%  { transform: translate(-3px,2px) skewX(-1deg); }
        100% { transform: translate(0,0) skewX(0deg); filter: hue-rotate(-5deg) contrast(115%); }
      }
      @keyframes flicker {
        0%,100% { opacity: .25; }
        40%     { opacity: .45; }
        60%     { opacity: .15; }
      }
      @keyframes scan {
        from { transform: translateY(-100%); }
        to   { transform: translateY(100%);  }
      }
    </style>
  </head>
  <body class="min-h-screen text-white">
    <!-- ========== SPLASH ========== -->
    <section id="splash">
      <!-- layered glitch effects -->
      <div class="glitch-layer" aria-hidden="true"></div>
      <div class="glitch-scan"  aria-hidden="true"></div>

      <h1 class="text-4xl md:text-5xl font-black tracking-wide drop-shadow-[0_2px_12px_rgba(0,0,0,.75)]">
        Sejin's Top Charts
      </h1>

      <div class="disclaimer">
        <p><strong>Extremely Long, Unnecessary Disclaimer.</strong> The following selections, rankings, ratings, opinions, preferences, impulses, whims, hunches, and vibes are solely those of Sejin. They are not the official positions of any studio, label, network, platform, distributor, algorithm, or snack brand. They must not be cited as medical, legal, culinary, romantic, investment, or life advice. Viewer discretion is advised, though probably unnecessary.</p>
        <p>By proceeding, you acknowledge that taste is subjective; that a 4.7/5 today could be a 4.6/5 tomorrow after a rewatch, a mood swing, a better soundtrack, or a stronger espresso; that nostalgia may distort judgment in ways both delightful and irrational; and that ranking is an art, not a science, unless science starts handing out K-drama awards.</p>
        <p>All titles, posters, and metadata are provided for personal enjoyment and casual debate only. Any resemblance to your own list—top ten, bottom five, or guilty pleasures—is either a coincidence or proof that you, too, have impeccable taste.</p>
        <p>By entering, you waive the right to be annoyed if your favorite got fewer stars than expected, to demand a recount, or to insist the soundtrack “hits harder” in the live version. You further agree that plot twists may be spoiled by time, not by this page; that villains can be sympathetic; and that sometimes, the second lead deserved better. Thank you for attending this legally non-binding ceremony of opinions.</p>
      </div>

      <button id="enterBtn" class="mt-8">Enter</button>
    </section>

    <!-- ========== MAIN APP ========== -->
    <div id="mainContent" style="display:none;">
      <header class="max-w-6xl mx-auto px-4 py-8">
        <h1 class="text-3xl md:text-4xl font-bold tracking-wide text-center">Sejin's Top Charts</h1>
        <div class="mt-6 flex items-center justify-center gap-3">
          <label for="tabSelect" class="sr-only">Select chart</label>
          <select id="tabSelect" class="bg-neutral-900 text-white px-4 py-2 rounded-xl border border-neutral-800 outline-none">
            <option value="KR Movie">Korean Movies</option>
            <option value="KR Drama" selected>Korean Dramas</option>
            <option value="KR Music">Korean Music</option>
            <option value="EN Movie">American Movies</option>
            <option value="EN Drama">American Dramas</option>
            <option value="EN Music">American Music</option>
          </select>
          <span id="currentLabel" class="inline-flex items-center gap-2 bg-neutral-900/70 border border-neutral-800 rounded-xl px-3 py-1 text-sm text-neutral-300">
            <img src="images/kr-flag.png" alt="KR" class="flag-icon"/> Korean Dramas
          </span>
        </div>
      </header>

      <main class="max-w-6xl mx-auto px-4 pb-16">
        <div id="grid" class="grid gap-6 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4"></div>
        <div id="status" class="text-center text-neutral-400 mt-10"></div>
      </main>
    </div>

    <script>
      // ===== Splash interactions =====
      const splash = document.getElementById('splash');
      const enterBtn = document.getElementById('enterBtn');

      // Random glitch scheduler
      function scheduleGlitch() {
        const wait = 1800 + Math.random() * 5200;       // random wait before next glitch
        setTimeout(() => {
          splash.classList.add('glitching');
          const duration = 300 + Math.random() * 600;    // random glitch duration
          setTimeout(() => {
            splash.classList.remove('glitching');
            scheduleGlitch();
          }, duration);
        }, wait);
      }
      scheduleGlitch();

      enterBtn.addEventListener('click', () => {
        splash.style.display = 'none';
        document.getElementById('mainContent').style.display = 'block';
      });

      // ===== Chart logic (unchanged) =====
      const SHEET_ID = '1bUhsAN58vjTtDpRmbciDszWbgANzjuFDOyO48hH-Jwg';
      const API_KEY  = 'AIzaSyAnYfAfgCELD3iP9NCJMbCoJOCAbEyeUz0';
      const IMG_DIR  = 'images/';
      const PLACEHOLDER = IMG_DIR + 'placeholder.png';

      const TABS = [
        { key: 'KR Movie', label: '<img src="images/kr-flag.png" alt="KR" class="flag-icon"/> Movies' },
        { key: 'KR Drama', label: '<img src="images/kr-flag.png" alt="KR" class="flag-icon"/> Dramas' },
        { key: 'KR Music', label: '<img src="images/kr-flag.png" alt="KR" class="flag-icon"/> Music' },
        { key: 'EN Movie', label: '<img src="images/us-flag.png" alt="EN" class="flag-icon"/> Movies' },
        { key: 'EN Drama', label: '<img src="images/us-flag.png" alt="EN" class="flag-icon"/> Dramas' },
        { key: 'EN Music', label: '<img src="images/us-flag.png" alt="EN" class="flag-icon"/> Music' },
      ];

      const statusEl = document.getElementById('status');
      const gridEl = document.getElementById('grid');
      const tabSelect = document.getElementById('tabSelect');
      const currentLabel = document.getElementById('currentLabel');

      function starHTML(value) {
        const clamped = Math.max(0, Math.min(5, Number(value) || 0));
        const pct = (clamped / 5) * 100;
        const stars = '★★★★★';
        return `
          <span class="stars" aria-label="Rating ${clamped} of 5">
            <span class="bg">${stars}</span>
            <span class="fg" style="width:${pct}%">${stars}</span>
          </span>
          <span class="text-neutral-400 text-xs ml-2">${clamped.toFixed(1)}</span>
        `;
      }

      function buildSrcCandidates(filename) {
        const safeName = (filename || '').trim();
        if (!safeName) return [];
        const enc = s => IMG_DIR + encodeURI(s);
        const m = safeName.match(/^(.*)\.([a-zA-Z0-9]+)$/);
        if (!m) return [enc(safeName)];
        const base = m[1], ext = m[2];
        const variantsByExt = {
          png:  ['png','PNG','jpg','JPG','jpeg','JPEG'],
          PNG:  ['PNG','png','JPG','jpg','JPEG','jpeg'],
          jpg:  ['jpg','JPG','png','PNG','jpeg','JPEG'],
          JPG:  ['JPG','jpg','PNG','png','JPEG','jpeg'],
          jpeg: ['jpeg','JPEG','jpg','JPG','png','PNG'],
          JPEG: ['JPEG','jpeg','JPG','jpg','PNG','png'],
        };
        const list = variantsByExt[ext] || [ext];
        return list.map(e => enc(`${base}.${e}`));
      }

      function handleImgErr(img) {
        const nextIndex = parseInt(img.dataset.errIndex || '0', 10) + 1;
        const candidates = (img.dataset.candidates || '').split('|').filter(Boolean);
        if (nextIndex < candidates.length) {
          img.dataset.errIndex = String(nextIndex);
          img.src = candidates[nextIndex];
        } else {
          img.onerror = null;
          img.src = PLACEHOLDER;
        }
      }

      function imgTagWithFallback(filename, title) {
        if (!filename) {
          return `<img class="poster mb-3" src="${PLACEHOLDER}" alt="${title}"/>`;
        }
        const candidates = buildSrcCandidates(filename);
        const primary = candidates[0] || PLACEHOLDER;
        const dataAttr = candidates.length ? `data-candidates="${candidates.join('|')}" data-err-index="0"` : '';
        const onerr = candidates.length ? 'onerror="handleImgErr(this)"' : '';
        return `<img class="poster mb-3" src="${primary}" alt="${title}" ${dataAttr} ${onerr}/>`;
      }

      function cardHTML(item) {
        const title = item.title || 'Untitled';
        const release = item.release || '';
               const producer = item.producer || '';
        return `
          <article class="card p-3">
            ${imgTagWithFallback(item.image, title)}
            <div class="flex items-start justify-between">
              <h3 class="text-base font-semibold leading-tight">${title}</h3>
              <span class="rank">#${item.rank || ''}</span>
            </div>
            ${release ? `<div class="text-xs font-semibold text-neutral-300 mt-1">${release}</div>` : ''}
            ${producer ? `<div class="text-xs font-semibold text-neutral-400">${producer}</div>` : ''}
            <div class="mt-2">${starHTML(item.rating)}</div>
          </article>
        `;
      }

      async function loadTab(tabName) {
        statusEl.textContent = 'Loading…';
        gridEl.innerHTML = '';
        try {
          const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/'${encodeURIComponent(tabName)}'?key=${API_KEY}`;
          const res = await fetch(url);
          if (!res.ok) throw new Error('Data fetch ' + res.status);
          const json = await res.json();
          const rows = json.values || [];
          if (rows.length < 2) { statusEl.textContent = 'No data found.'; return; }
          const [, ...data] = rows;
          const items = data.map((r, i) => ({
            rank: r[0] ?? String(i+1),
            title: r[1] ?? '',
            release: r[2] ?? '',
            producer: r[3] ?? '',
            rating: parseFloat(r[4] ?? '0') || 0,
            image: (r[5] || '').trim()
          }));
          gridEl.innerHTML = items.map(cardHTML).join('');
          statusEl.textContent = '';
        } catch (err) {
          console.error(err);
          statusEl.innerHTML = `<span class="text-red-400">Failed to load. Check sharing, key, and tab name.</span>`;
        }
      }

      tabSelect.addEventListener('change', () => {
        const tabName = tabSelect.value;
        const meta = TABS.find(t => t.key === tabName);
        currentLabel.innerHTML = (meta ? meta.label : tabName);
        loadTab(tabName);
      });

      // Default load
      loadTab('KR Drama');
    </script>
  </body>
</html>
